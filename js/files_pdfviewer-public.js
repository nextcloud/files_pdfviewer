(()=>{var e={5950:(e,t,r)=>{"use strict";const s=r(2322),{MAX_LENGTH:n,MAX_SAFE_INTEGER:i}=r(6692),{safeRe:o,t:a}=r(5208),c=r(9901),{compareIdentifiers:E}=r(3229);class l{constructor(e,t){if(t=c(t),e instanceof l){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw new TypeError(`version is longer than ${n} characters`);s("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?o[a.LOOSE]:o[a.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(s("SemVer.compare",this.version,this.options,e),!(e instanceof l)){if("string"==typeof e&&e===this.version)return 0;e=new l(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof l||(e=new l(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof l||(e=new l(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],n=e.prerelease[t];if(s("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return E(r,n)}while(++t)}compareBuild(e){e instanceof l||(e=new l(e,this.options));let t=0;do{const r=this.build[t],n=e.build[t];if(s("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return E(r,n)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?o[a.PRERELEASELOOSE]:o[a.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let s=this.prerelease.length;for(;--s>=0;)"number"==typeof this.prerelease[s]&&(this.prerelease[s]++,s=-2);if(-1===s){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let s=[t,e];!1===r&&(s=[t]),0===E(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=l},8064:(e,t,r)=>{"use strict";const s=r(5950);e.exports=(e,t)=>new s(e,t).major},8690:(e,t,r)=>{"use strict";const s=r(5950);e.exports=(e,t,r=!1)=>{if(e instanceof s)return e;try{return new s(e,t)}catch(e){if(!r)return null;throw e}}},8711:(e,t,r)=>{"use strict";const s=r(8690);e.exports=(e,t)=>{const r=s(e,t);return r?r.version:null}},6692:e=>{"use strict";const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},2322:(e,t,r)=>{"use strict";var s=r(5606);const n="object"==typeof s&&s.env&&s.env.NODE_DEBUG&&/\bsemver\b/i.test(s.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=n},3229:e=>{"use strict";const t=/^[0-9]+$/,r=(e,r)=>{if("number"==typeof e&&"number"==typeof r)return e===r?0:e<r?-1:1;const s=t.test(e),n=t.test(r);return s&&n&&(e=+e,r=+r),e===r?0:s&&!n?-1:n&&!s?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},9901:e=>{"use strict";const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},5208:(e,t,r)=>{"use strict";const{MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:i}=r(6692),o=r(2322),a=(t=e.exports={}).re=[],c=t.safeRe=[],E=t.src=[],l=t.safeSrc=[],h=t.t={};let u=0;const p="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",i],[p,n]],I=(e,t,r)=>{const s=(e=>{for(const[t,r]of d)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=u++;o(e,n,t),h[e]=n,E[n]=t,l[n]=s,a[n]=new RegExp(t,r?"g":void 0),c[n]=new RegExp(s,r?"g":void 0)};I("NUMERICIDENTIFIER","0|[1-9]\\d*"),I("NUMERICIDENTIFIERLOOSE","\\d+"),I("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),I("MAINVERSION",`(${E[h.NUMERICIDENTIFIER]})\\.(${E[h.NUMERICIDENTIFIER]})\\.(${E[h.NUMERICIDENTIFIER]})`),I("MAINVERSIONLOOSE",`(${E[h.NUMERICIDENTIFIERLOOSE]})\\.(${E[h.NUMERICIDENTIFIERLOOSE]})\\.(${E[h.NUMERICIDENTIFIERLOOSE]})`),I("PRERELEASEIDENTIFIER",`(?:${E[h.NONNUMERICIDENTIFIER]}|${E[h.NUMERICIDENTIFIER]})`),I("PRERELEASEIDENTIFIERLOOSE",`(?:${E[h.NONNUMERICIDENTIFIER]}|${E[h.NUMERICIDENTIFIERLOOSE]})`),I("PRERELEASE",`(?:-(${E[h.PRERELEASEIDENTIFIER]}(?:\\.${E[h.PRERELEASEIDENTIFIER]})*))`),I("PRERELEASELOOSE",`(?:-?(${E[h.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${E[h.PRERELEASEIDENTIFIERLOOSE]})*))`),I("BUILDIDENTIFIER",`${p}+`),I("BUILD",`(?:\\+(${E[h.BUILDIDENTIFIER]}(?:\\.${E[h.BUILDIDENTIFIER]})*))`),I("FULLPLAIN",`v?${E[h.MAINVERSION]}${E[h.PRERELEASE]}?${E[h.BUILD]}?`),I("FULL",`^${E[h.FULLPLAIN]}$`),I("LOOSEPLAIN",`[v=\\s]*${E[h.MAINVERSIONLOOSE]}${E[h.PRERELEASELOOSE]}?${E[h.BUILD]}?`),I("LOOSE",`^${E[h.LOOSEPLAIN]}$`),I("GTLT","((?:<|>)?=?)"),I("XRANGEIDENTIFIERLOOSE",`${E[h.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),I("XRANGEIDENTIFIER",`${E[h.NUMERICIDENTIFIER]}|x|X|\\*`),I("XRANGEPLAIN",`[v=\\s]*(${E[h.XRANGEIDENTIFIER]})(?:\\.(${E[h.XRANGEIDENTIFIER]})(?:\\.(${E[h.XRANGEIDENTIFIER]})(?:${E[h.PRERELEASE]})?${E[h.BUILD]}?)?)?`),I("XRANGEPLAINLOOSE",`[v=\\s]*(${E[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${E[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${E[h.XRANGEIDENTIFIERLOOSE]})(?:${E[h.PRERELEASELOOSE]})?${E[h.BUILD]}?)?)?`),I("XRANGE",`^${E[h.GTLT]}\\s*${E[h.XRANGEPLAIN]}$`),I("XRANGELOOSE",`^${E[h.GTLT]}\\s*${E[h.XRANGEPLAINLOOSE]}$`),I("COERCEPLAIN",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?`),I("COERCE",`${E[h.COERCEPLAIN]}(?:$|[^\\d])`),I("COERCEFULL",E[h.COERCEPLAIN]+`(?:${E[h.PRERELEASE]})?`+`(?:${E[h.BUILD]})?(?:$|[^\\d])`),I("COERCERTL",E[h.COERCE],!0),I("COERCERTLFULL",E[h.COERCEFULL],!0),I("LONETILDE","(?:~>?)"),I("TILDETRIM",`(\\s*)${E[h.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",I("TILDE",`^${E[h.LONETILDE]}${E[h.XRANGEPLAIN]}$`),I("TILDELOOSE",`^${E[h.LONETILDE]}${E[h.XRANGEPLAINLOOSE]}$`),I("LONECARET","(?:\\^)"),I("CARETTRIM",`(\\s*)${E[h.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",I("CARET",`^${E[h.LONECARET]}${E[h.XRANGEPLAIN]}$`),I("CARETLOOSE",`^${E[h.LONECARET]}${E[h.XRANGEPLAINLOOSE]}$`),I("COMPARATORLOOSE",`^${E[h.GTLT]}\\s*(${E[h.LOOSEPLAIN]})$|^$`),I("COMPARATOR",`^${E[h.GTLT]}\\s*(${E[h.FULLPLAIN]})$|^$`),I("COMPARATORTRIM",`(\\s*)${E[h.GTLT]}\\s*(${E[h.LOOSEPLAIN]}|${E[h.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",I("HYPHENRANGE",`^\\s*(${E[h.XRANGEPLAIN]})\\s+-\\s+(${E[h.XRANGEPLAIN]})\\s*$`),I("HYPHENRANGELOOSE",`^\\s*(${E[h.XRANGEPLAINLOOSE]})\\s+-\\s+(${E[h.XRANGEPLAINLOOSE]})\\s*$`),I("STAR","(<|>)?=?\\s*\\*"),I("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),I("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},5606:e=>{var t,r,s=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var a,c=[],E=!1,l=-1;function h(){E&&a&&(E=!1,a.length?c=a.concat(c):l=-1,c.length&&u())}function u(){if(!E){var e=o(h);E=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,E=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function d(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||E||o(u)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=d,s.addListener=d,s.once=d,s.off=d,s.removeListener=d,s.removeAllListeners=d,s.emit=d,s.prependListener=d,s.prependOnceListener=d,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}(()=>{"use strict";const e=(e,t,r)=>{const s=Object.assign({escape:!0},r||{});return"/"!==e.charAt(0)&&(e="/"+e),n=(n=t||{})||{},e.replace(/{([^{}]*)}/g,(function(e,t){const r=n[t];return s.escape?"string"==typeof r||"number"==typeof r?encodeURIComponent(r.toString()):encodeURIComponent(e):"string"==typeof r||"number"==typeof r?r.toString():e}));var n},t=(t,r,n)=>{const i=Object.assign({noRewrite:!1},n||{}),o=n?.baseURL??s();return!0!==window?.OC?.config?.modRewriteWorking||i.noRewrite?o+"/index.php"+e(t,r,n):o+e(t,r,n)};function s(){let e=window._oc_webroot;if(void 0===e){e=location.pathname;const t=e.indexOf("/index.php/");if(-1!==t)e=e.slice(0,t);else{const t=e.indexOf("/",1);e=e.slice(0,t>0?t:void 0)}}return e}var n=r(8064),i=r(8711);class o{bus;constructor(e){"function"==typeof e.getVersion&&i(e.getVersion())?n(e.getVersion())!==n(this.getVersion())&&console.warn("Proxying an event bus of version "+e.getVersion()+" with "+this.getVersion()):console.warn("Proxying an event bus with an unknown or invalid version"),this.bus=e}getVersion(){return"3.3.3"}subscribe(e,t){this.bus.subscribe(e,t)}unsubscribe(e,t){this.bus.unsubscribe(e,t)}emit(e,...t){this.bus.emit(e,...t)}}class a{handlers=new Map;getVersion(){return"3.3.3"}subscribe(e,t){this.handlers.set(e,(this.handlers.get(e)||[]).concat(t))}unsubscribe(e,t){this.handlers.set(e,(this.handlers.get(e)||[]).filter((e=>e!==t)))}emit(e,...t){(this.handlers.get(e)||[]).forEach((e=>{try{e(t[0])}catch(e){console.error("could not invoke event listener",e)}}))}}let c,E=null;function l(){return null!==E?E:"undefined"==typeof window?new Proxy({},{get:()=>()=>console.error("Window not available, EventBus can not be established!")}):(window.OC?._eventBus&&void 0===window._nc_event_bus&&(console.warn("found old event bus instance at OC._eventBus. Update your version!"),window._nc_event_bus=window.OC._eventBus),E=void 0!==window?._nc_event_bus?new o(window._nc_event_bus):window._nc_event_bus=new a,E)}class h{static GLOBAL_SCOPE_VOLATILE="nextcloud_vol";static GLOBAL_SCOPE_PERSISTENT="nextcloud_per";scope;wrapped;constructor(e,t,r){this.scope=`${r?h.GLOBAL_SCOPE_PERSISTENT:h.GLOBAL_SCOPE_VOLATILE}_${btoa(e)}_`,this.wrapped=t}scopeKey(e){return`${this.scope}${e}`}setItem(e,t){this.wrapped.setItem(this.scopeKey(e),t)}getItem(e){return this.wrapped.getItem(this.scopeKey(e))}removeItem(e){this.wrapped.removeItem(this.scopeKey(e))}clear(){Object.keys(this.wrapped).filter((e=>e.startsWith(this.scope))).map(this.wrapped.removeItem.bind(this.wrapped))}}class u{appId;persisted=!1;clearedOnLogout=!1;constructor(e){this.appId=e}persist(e=!0){return this.persisted=e,this}clearOnLogout(e=!0){return this.clearedOnLogout=e,this}build(){return new h(this.appId,this.persisted?window.localStorage:window.sessionStorage,!this.clearedOnLogout)}}const p=[];var d,I;d="csrf-token-update",I=e=>{c=e.token,p.forEach((e=>{try{e(c)}catch(e){console.error("Error updating CSRF token observer",e)}}))},l().subscribe(d,I);(f="public",new u(f)).persist().build();var f;let L;function R(e,t){return e?e.getAttribute(t):null}var m=(e=>(e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warn=2]="Warn",e[e.Error=3]="Error",e[e.Fatal=4]="Fatal",e))(m||{});class O{context;constructor(e){this.context=e||{}}formatMessage(e,t,r){let s="["+m[t].toUpperCase()+"] ";return r&&r.app&&(s+=r.app+": "),"string"==typeof e?s+e:(s+=`Unexpected ${e.name}`,e.message&&(s+=` "${e.message}"`),t===m.Debug&&e.stack&&(s+=`\n\nStack trace:\n${e.stack}`),s)}log(e,t,r){if(!("number"==typeof this.context?.level&&e<this.context?.level))switch("object"==typeof t&&void 0===r?.error&&(r.error=t),e){case m.Debug:console.debug(this.formatMessage(t,m.Debug,r),r);break;case m.Info:console.info(this.formatMessage(t,m.Info,r),r);break;case m.Warn:console.warn(this.formatMessage(t,m.Warn,r),r);break;case m.Error:console.error(this.formatMessage(t,m.Error,r),r);break;case m.Fatal:default:console.error(this.formatMessage(t,m.Fatal,r),r)}}debug(e,t){this.log(m.Debug,e,Object.assign({},this.context,t))}info(e,t){this.log(m.Info,e,Object.assign({},this.context,t))}warn(e,t){this.log(m.Warn,e,Object.assign({},this.context,t))}error(e,t){this.log(m.Error,e,Object.assign({},this.context,t))}fatal(e,t){this.log(m.Fatal,e,Object.assign({},this.context,t))}}function N(e){return new O(e)}class g{context;factory;constructor(e){this.context={},this.factory=e}setApp(e){return this.context.app=e,this}setLogLevel(e){return this.context.level=e,this}setUid(e){return this.context.uid=e,this}detectUser(){const e=function(){if(void 0!==L)return L;const e=document?.getElementsByTagName("head")[0];if(!e)return null;const t=R(e,"data-user");return null===t?(L=null,L):(L={uid:t,displayName:R(e,"data-user-displayname"),isAdmin:!!window._oc_isadmin},L)}();return null!==e&&(this.context.uid=e.uid),this}detectLogLevel(){const e=this,t=()=>{"complete"===document.readyState||"interactive"===document.readyState?(e.context.level=window._oc_config?.loglevel??m.Warn,window._oc_debug&&(e.context.level=m.Debug),document.removeEventListener("readystatechange",t)):document.addEventListener("readystatechange",t)};return t(),this}build(){return void 0===this.context.level&&this.detectLogLevel(),this.factory(this.context)}}function w(){return new g(N)}const A=w().setApp("Files_PDFViewer").detectUser().build(),v=document.getElementById("hideDownload"),$=()=>v&&"true"===v.value,T=document.getElementById("isPublic"),b=()=>!(!T||"1"!==T.value),S=document.getElementById("mimetype"),y=()=>S&&"application/pdf"===S.value,D=()=>$()&&void 0!==OCA.RichDocuments;window.addEventListener("DOMContentLoaded",(function(){if(A.debug("Initializing for public page",{isPublicPage:b(),hideDownload:$(),isSecureViewerAvailable:D()}),!b()||y())if(b()&&y()&&!D()){const e=location.hash.split("page=")[1]||0,r=document.getElementById("files-public-content"),s=document.getElementById("sharingToken"),n=document.querySelector("body > footer")||document.querySelector("#app-content > footer"),i=document.querySelector("#content"),o=s.value,a=t("/s/{token}/download",{token:o}),c=t("/apps/files_pdfviewer/?file={downloadUrl}&hideDownload={hideDownload}#page={page}",{hideDownload:$()?1:0,downloadUrl:a,page:e});if(r){if(r.innerHTML="",OCA.Viewer)OCA.Viewer.setRootElement("#files-public-content"),OCA.Viewer.open({path:"/"});else{A.error("Viewer not available, PDF viewer directly injected");const e=document.createElement("iframe");e.style.height="100%",e.style.width="100%",e.style.position="absolute",r.appendChild(e),e.src=c}n.style.display="none",i.style.minHeight="calc(100% - var(--header-height))",i.style.marginLeft="0",i.style.marginRight="0",i.style.width="100%",i.style.borderRadius="unset"}else A.error("Unable to inject the PDF Viewer")}else A.error("But this does not appear to be a public page");else A.debug("But this is not a single pdf share")}))})()})();
//# sourceMappingURL=files_pdfviewer-public.js.map?v=bb1fb80358cb6290ddea